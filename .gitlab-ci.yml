variables:
  GIT_SUBMODULE_STRATEGY: recursive

stages:
  - build
  - test

build-ubuntu_22.04:
  image: spack/ubuntu-jammy
  stage: build
  script:
    # NOTE: Non-Spack base image should enable the following line.
    #- apt update && DEBIAN_FRONTEND=noninteractive apt install -y build-essential ca-certificates coreutils curl environment-modules gfortran git gpg lsb-release python3 python3-distutils python3-venv unzip zip 
    - ./install_dep.sh
    - ./build.sh
  artifacts:
    when: on_success
    paths:
      - "build/"

#build-opensuseleap_15:
#  stage: build
#  script:
#    - echo "Compiling the code..."
#    - echo "Compile complete."

#build-rocky_9:
#  stage: build
#  script:
#    - echo "Compiling the code..."
#    - echo "Compile complete."

test-ubuntu_22.04:
  image: ubuntu:22.04
  stage: test
  script:
    - apt-get update && apt install -y cmake
    - CTEST_OUTPUT_ON_FAILURE=1 ASAN_OPTIONS=detect_leaks=1 ctest --exclude-regex AsRoot
    - sudo CTEST_OUTPUT_ON_FAILURE=1 ASAN_OPTIONS=detect_leaks=1 ctest --tests-regex AsRoot
