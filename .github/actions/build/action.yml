inputs:
  image-name:
    description: "Container image name"

runs:
  using: "composite"
  steps:
    - name: Initialize git repository
      shell: bash
      run: git config --global --add safe.directory '*'

    - name: Activate preloaded Spack environment
      shell: bash
      run: |
        cd /home/docker
        spack/bin/spack env activate spack-environment

    - name: Run build script
      shell: bash
      run: ./build.sh -DBUILD_DIR=$PWD/build

    - name: Upload build
      uses: actions/upload-artifact@v4
      with:
        name: build-${{ inputs.image-name }}
        path: ./build
