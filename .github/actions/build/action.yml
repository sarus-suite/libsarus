inputs:
  image-name:
    description: "Container image name"

runs:
  using: "composite"
  steps:
    - name: Initialize git repository
      shell: bash
      run: git config --global --add safe.directory '*'

    - shell: bash
      run: |
        echo $PWD
        ls $PWD
        ls $PWD/ci
        ls $PWD/ci/spack
        ls $PWD/ci/spack/bin
        ls /__w/libsarus/libsarus/ci/spack/bin

    - name: Run build script
      shell: bash
      run: ./build.sh -DBUILD_DIR=$PWD/build

    - name: Upload build
      uses: actions/upload-artifact@v4
      with:
        name: build-${{ inputs.image-name }}
        path: ./build
